# Prizrak Car Card Examples

## Установка

### 1. Установите зависимости

Карточка использует два кастомных компонента, которые необходимо установить через HACS:

#### 1.1 card-mod (обязательно)
Используется для стилизации карточек (градиенты, границы, размеры).

**Установка через HACS:**
1. Откройте HACS → Frontend
2. Нажмите "+" в правом нижнем углу
3. Найдите "card-mod"
4. Нажмите "Install"

#### 1.2 button-card (обязательно)
Используется для интерактивных кнопок охраны и автозапуска с подтверждением.

**Установка через HACS:**
1. Откройте HACS → Frontend
2. Нажмите "+" в правом нижнем углу
3. Найдите "button-card"
4. Нажмите "Install"

#### 1.3 Перезагрузите Home Assistant
После установки обоих компонентов перезагрузите Home Assistant для применения изменений.

### 2. Скопируйте SVG файлы

После установки интеграции Prizrak, SVG файлы автоматически копируются в `/config/www/prizrak/`.

Убедитесь, что следующие файлы присутствуют:
- `/config/www/prizrak/car-full.svg` - изображение машины
- `/config/www/prizrak/car-perimeter.svg` - голубой периметр охраны

### 3. Настройте карточку

1. Откройте файл `car-card.yaml`
2. Замените все вхождения `95311` на ID вашего устройства
3. Скопируйте содержимое файла в вашу Home Assistant dashboard

## Возможности карточки

### Информационные блоки

**Ряд 1 - Температуры:**
- На улице
- Двигатель
- В салоне

**Ряд 2 - Основная информация:**
- Напряжение батареи
- Обороты двигателя
- Изображение машины с индикацией состояния
- Уровень топлива
- Скорость

**Ряд 3 - Управление:**
- Пробег (информационный блок)
- **Охрана** (интерактивный блок с подтверждением)
- **Автозапуск** (интерактивный блок с подтверждением)

### Интерактивные блоки

#### Охрана
- **Нажатие:** Открывает диалог подтверждения
- **Включение:** Показывает голубой периметр вокруг машины и иконку щита
- **Выключение:** Убирает визуальные эффекты охраны

#### Автозапуск
- **Нажатие:** Открывает диалог подтверждения
- **Включение:** Показывает иконку двигателя на машине
- **Выключение:** Убирает иконку двигателя

## Визуальные эффекты

### Периметр охраны
При включении охраны вокруг машины появляется голубой периметр (как в оригинальном веб-интерфейсе monitoring.tecel.ru).

Цвета периметра:
- **Голубой (#4cb2f1)** - охрана включена
- **Прозрачный** - охрана выключена

### Иконки состояния
- **Щит (shield-check)** - охрана активна
- **Двигатель (engine)** - двигатель запущен

## Кастомизация

### Изменение цветов

Вы можете изменить цвета в блоках охраны и автозапуска, отредактировав секцию `styles`:

```yaml
styles:
  icon:
    - color: >
        [[[ return entity.state === 'on' ? '#00c0fc' : '#95a5a6'; ]]]
```

### Изменение текста подтверждения

Текст диалога подтверждения можно изменить в секции `confirmation`:

```yaml
confirmation:
  text: >
    [[[ return entity.state === 'on' ? 'Выключить охрану?' : 'Включить охрану?'; ]]]
```

## Устранение неполадок

### Карточка не отображается или показывает ошибки
1. Убедитесь, что установлены оба компонента: `card-mod` и `custom:button-card`
2. Перезагрузите Home Assistant после установки компонентов
3. Очистите кэш браузера (Ctrl+Shift+R)
4. Проверьте консоль браузера (F12) на наличие ошибок

### Не отображаются SVG файлы
1. Проверьте, что интеграция Prizrak установлена и настроена
2. Убедитесь, что файлы находятся в `/config/www/prizrak/`
3. Проверьте путь к файлам: должен быть `/local/prizrak/car-full.svg`
4. Очистите кэш браузера (Ctrl+Shift+R)

### Стили не применяются (нет градиентов, границ)
1. Убедитесь, что `card-mod` установлен через HACS
2. Проверьте логи Home Assistant: `Settings → System → Logs`
3. Перезагрузите Home Assistant
4. Очистите кэш браузера

### Кнопки не работают или показывают диалог "more-info"
1. Убедитесь, что `custom:button-card` установлен через HACS
2. Проверьте, что ID устройства правильный во всех местах карточки
3. Проверьте логи Home Assistant на наличие ошибок
4. Проверьте наличие кнопок: `Developer Tools → States` → найдите `button.prizrak_[ID]_guard_on`

### Периметр не отображается при включении охраны
1. Проверьте, что файл `car-perimeter.svg` присутствует в `/config/www/prizrak/`
2. Убедитесь, что сенсор `binary_sensor.prizrak_[ID]_guard` работает корректно
3. Проверьте состояние сенсора в `Developer Tools → States`
4. Убедитесь, что conditional element правильно настроен в карточке
