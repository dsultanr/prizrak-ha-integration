# Prizrak Monitoring - Control Panel Card
# Точная копия control-info__surface из monitoring.tecel.ru
#
# REQUIREMENTS:
# 1. Install card-mod via HACS (Frontend) - для стилизации
# 2. Install custom:button-card via HACS (Frontend) - для интерактивных кнопок
# 3. SVG files will be automatically copied to /config/www/prizrak/ by the integration
# 4. Replace 95311 with your device ID throughout this file
#
# FEATURES:
# - Blue perimeter appears around car when guard is ON
# - Interactive guard and autolaunch buttons with confirmation dialogs
# - Real-time status updates for all sensors

type: vertical-stack
card_mod:
  style: |
    ha-card {
      max-width: 400px;
      margin: 0 auto;
    }
cards:
  # Row 1: Temperatures (3 blocks)
  - type: horizontal-stack
    cards:
      - type: tile
        entity: sensor.prizrak_95311_outside_temperature
        name: На улице
        icon: mdi:thermometer
        vertical: true
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
              border-bottom: 1px solid #747b97;
            }
      - type: tile
        entity: sensor.prizrak_95311_engine_temperature
        name: Двигатель
        icon: mdi:engine
        vertical: true
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
              border-left: 1px solid #747b97;
              border-right: 1px solid #747b97;
              border-bottom: 1px solid #747b97;
            }
      - type: tile
        entity: sensor.prizrak_95311_temperature
        name: В салоне
        icon: mdi:home-thermometer
        vertical: true
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
              border-bottom: 1px solid #747b97;
            }

  # Row 2: Left column (Voltage+RPM), Center (SVG Car), Right column (Fuel+Speed)
  - type: horizontal-stack
    cards:
      # Left column: Voltage and RPM stacked
      - type: vertical-stack
        cards:
          - type: tile
            entity: sensor.prizrak_95311_battery_voltage
            name: Напряжение
            icon: mdi:car-battery
            vertical: false
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                  border-bottom: 1px solid #747b97;
                }
          - type: tile
            entity: sensor.prizrak_95311_rpm
            name: Обороты
            icon: mdi:engine
            vertical: false
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                  border-bottom: 1px solid #747b97;
                }

      # Center: SVG Car (120x180px)
      - type: picture-elements
        image: /local/prizrak/car-full.svg
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
              border-left: 1px solid #747b97;
              border-right: 1px solid #747b97;
              width: 120px !important;
              height: 180px !important;
              flex-shrink: 0;
            }
            #root {
              width: 120px !important;
              height: 180px !important;
            }
        elements:
          # Guard perimeter (blue outline when guard is on)
          - type: conditional
            conditions:
              - entity: binary_sensor.prizrak_95311_guard
                state: "on"
            elements:
              - type: image
                image: /local/prizrak/car-perimeter.svg
                style:
                  top: 0
                  left: 0
                  width: 100%
                  height: 100%
                  pointer-events: none

          # Guard status overlay (icon)
          - type: conditional
            conditions:
              - entity: binary_sensor.prizrak_95311_guard
                state: "on"
            elements:
              - type: icon
                icon: mdi:shield-check
                style:
                  top: 10%
                  left: 50%
                  color: "#00c0fc"
                  --mdc-icon-size: 30px
                  opacity: 0.8

          # Ignition status overlay
          - type: conditional
            conditions:
              - entity: binary_sensor.prizrak_95311_ignition
                state: "on"
            elements:
              - type: icon
                icon: mdi:engine
                style:
                  top: 10%
                  left: 50%
                  color: "#ffffff"
                  --mdc-icon-size: 30px
                  opacity: 1

          # Temperature in center
          - type: state-label
            entity: sensor.prizrak_95311_temperature
            suffix: "°C"
            style:
              top: 50%
              left: 50%
              color: white
              font-size: 18px
              font-weight: bold
              text-shadow: 2px 2px 4px rgba(0,0,0,0.8)

      # Right column: Fuel and Speed stacked
      - type: vertical-stack
        cards:
          - type: tile
            entity: sensor.prizrak_95311_fuel_level
            name: Топливо
            icon: mdi:gas-station
            vertical: false
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                  border-bottom: 1px solid #747b97;
                }
          - type: tile
            entity: sensor.prizrak_95311_speed
            name: Скорость
            icon: mdi:speedometer
            vertical: false
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                  border-bottom: 1px solid #747b97;
                }

  # Row 3: Odometer, Guard Status, Autolaunch status (3 blocks)
  - type: horizontal-stack
    cards:
      - type: tile
        entity: sensor.prizrak_95311_odometer
        name: Пробег
        icon: mdi:counter
        vertical: true
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            }

      - type: custom:button-card
        entity: binary_sensor.prizrak_95311_guard
        name: Охрана
        icon: mdi:shield-check
        show_state: true
        show_label: false
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: >
              [[[ return entity.state === 'on' ? 'button.prizrak_95311_guard_off' : 'button.prizrak_95311_guard_on'; ]]]
          confirmation:
            text: >
              [[[ return entity.state === 'on' ? 'Выключить охрану?' : 'Включить охрану?'; ]]]
        styles:
          card:
            - background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%)
            - border-left: 1px solid #747b97
            - border-right: 1px solid #747b97
          icon:
            - color: >
                [[[ return entity.state === 'on' ? '#00c0fc' : '#95a5a6'; ]]]
          name:
            - font-size: 12px
            - color: white
          state:
            - font-size: 14px
            - font-weight: bold
            - color: white

      - type: custom:button-card
        entity: binary_sensor.prizrak_95311_ignition
        name: Автозапуск
        icon: mdi:engine
        show_state: true
        show_label: false
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: >
              [[[ return entity.state === 'on' ? 'button.prizrak_95311_autolaunch_off' : 'button.prizrak_95311_autolaunch_on'; ]]]
          confirmation:
            text: >
              [[[ return entity.state === 'on' ? 'Выключить автозапуск?' : 'Включить автозапуск?'; ]]]
        styles:
          card:
            - background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%)
          icon:
            - color: >
                [[[ return entity.state === 'on' ? '#ffffff' : '#95a5a6'; ]]]
          name:
            - font-size: 12px
            - color: white
          state:
            - font-size: 14px
            - font-weight: bold
            - color: white
